<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snapzify Photobooth</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .photobooth-container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        max-width: 1200px;
        width: 100%;
      }

      .header {
        background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
        color: white;
        text-align: center;
        padding: 20px;
      }

      .main-content {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        padding: 30px;
      }

      .camera-section {
        flex: 2;
        min-width: 400px;
      }

      .controls-section {
        flex: 1;
        min-width: 300px;
      }

      .camera-container {
        position: relative;
        background: #f8f9fa;
        border-radius: 15px;
        overflow: hidden;
        margin-bottom: 20px;
      }

      #video,
      #canvas {
        width: 100%;
        height: auto;
        display: block;
        transform: scaleX(-1); /* Remove mirror effect */
      }

      #canvas {
        display: none;
      }

      .frame-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 2;
      }

      .sticker-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 3;
      }

      .sticker {
        position: absolute;
        cursor: move;
        user-select: none;
        font-size: 30px;
        pointer-events: auto;
      }

      .camera-controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 25px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .btn-primary {
        background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        color: white;
      }

      .btn-secondary {
        background: linear-gradient(45deg, #4ecdc4, #44a08d);
        color: white;
      }

      .btn-success {
        background: linear-gradient(45deg, #43e97b, #38f9d7);
        color: white;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .control-group {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .control-group h3 {
        margin-bottom: 15px;
        color: #333;
        font-size: 18px;
      }

      .frame-selector,
      .filter-selector,
      .sticker-selector {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
      }

      .frame-option,
      .filter-option,
      .sticker-option {
        aspect-ratio: 1;
        border: 3px solid transparent;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        background: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .frame-option.active,
      .filter-option.active {
        border-color: #ff6b6b;
        transform: scale(1.05);
      }

      .sticker-option {
        font-size: 24px;
        background: #fff;
      }

      .sticker-option:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .retake-counter {
        text-align: center;
        margin: 20px 0;
        font-size: 18px;
        font-weight: bold;
        color: #666;
      }

      .photo-strip {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 20px;
      }

      .photo-slot {
        aspect-ratio: 1;
        background: #f0f0f0;
        border: 2px dashed #ccc;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        color: #666;
        position: relative;
        overflow: hidden;
      }

      .photo-slot img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
      }

      .photo-slot {
        position: relative;
      }

      .photo-delete-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: #ff4757;
        color: white;
        border: none;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        font-size: 12px;
        cursor: pointer;
        display: none;
        z-index: 10;
        transition: all 0.3s ease;
      }

      .photo-slot:hover .photo-delete-btn {
        display: block;
      }

      .photo-delete-btn:hover {
        background: #ff3742;
        transform: scale(1.1);
      }

      .download-section {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid #eee;
      }

      .filters {
        display: none;
      }

      @keyframes heartBeat {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.5;
          transform: scale(1.2);
        }
      }

      @keyframes neonGlow {
        0% {
          box-shadow: 0 0 30px #ff0080, inset 0 0 30px #00ffff;
        }
        100% {
          box-shadow: 0 0 50px #00ffff, inset 0 0 50px #ff0080;
        }
      }

      @media (max-width: 768px) {
        .main-content {
          flex-direction: column;
        }

        .camera-section,
        .controls-section {
          min-width: unset;
        }

        .frame-selector,
        .filter-selector,
        .sticker-selector {
          grid-template-columns: repeat(4, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div class="photobooth-container">
      <div class="header">
        <h1>üì∏ Snapzify Photobooth</h1>
        <p>Ambil foto dengan berbagai frame, filter, dan sticker!</p>
      </div>

      <div class="main-content">
        <div class="camera-section">
          <div class="camera-container">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas"></canvas>
            <div class="frame-overlay" id="frameOverlay"></div>
            <div class="sticker-overlay" id="stickerOverlay"></div>
          </div>

          <div class="camera-controls">
            <button class="btn btn-primary" id="captureBtn">
              üì∑ Ambil Foto
            </button>
            <button class="btn btn-secondary" id="retakeBtn" disabled>
              üîÑ Ulangi
            </button>
            <button class="btn btn-success" id="startBtn">
              üé¨ Mulai Kamera
            </button>
          </div>

          <div class="retake-counter">
            <span id="retakeCount">Sisa Retake: 3</span>
          </div>

          <div class="photo-strip">
            <div class="photo-slot" id="slot1">Foto 1</div>
            <div class="photo-slot" id="slot2">Foto 2</div>
            <div class="photo-slot" id="slot3">Foto 3</div>
            <div class="photo-slot" id="slot4">Foto 4</div>
            <div class="photo-slot" id="slot5">Foto 5</div>
            <div class="photo-slot" id="slot6">Foto 6</div>
          </div>
        </div>

        <div class="controls-section">
          <div class="control-group">
            <h3>üñºÔ∏è Pilih Frame</h3>
            <div class="frame-selector">
              <div class="frame-option active" data-frame="none">
                Tanpa Frame
              </div>
              <div class="frame-option" data-frame="classic">Klasik</div>
              <div class="frame-option" data-frame="heart">Love</div>
              <div class="frame-option" data-frame="star">Bintang</div>
              <div class="frame-option" data-frame="floral">Bunga</div>
              <div class="frame-option" data-frame="geometric">Geometri</div>
            </div>
          </div>

          <div class="control-group">
            <h3>üé® Pilih Filter</h3>
            <div class="filter-selector">
              <div class="filter-option active" data-filter="none">Normal</div>
              <div class="filter-option" data-filter="grayscale">B&W</div>
              <div class="filter-option" data-filter="sepia">Sepia</div>
              <div class="filter-option" data-filter="vintage">Vintage</div>
              <div class="filter-option" data-filter="bright">Bright</div>
              <div class="filter-option" data-filter="contrast">Kontras</div>
            </div>
          </div>

          <div class="control-group">
            <h3>‚ú® Tambah Sticker</h3>
            <div class="sticker-selector">
              <div class="sticker-option" data-sticker="üòä">üòä</div>
              <div class="sticker-option" data-sticker="üòé">üòé</div>
              <div class="sticker-option" data-sticker="‚ù§Ô∏è">‚ù§Ô∏è</div>
              <div class="sticker-option" data-sticker="üéâ">üéâ</div>
              <div class="sticker-option" data-sticker="‚≠ê">‚≠ê</div>
              <div class="sticker-option" data-sticker="üåü">üåü</div>
              <div class="sticker-option" data-sticker="üéà">üéà</div>
              <div class="sticker-option" data-sticker="üéä">üéä</div>
              <div class="sticker-option" data-sticker="ü¶Ñ">ü¶Ñ</div>
            </div>
            <br />
            <button
              class="btn btn-secondary"
              id="clearStickers"
              style="margin-top: 10px; width: 100%"
            >
              Hapus Semua Sticker
            </button>
          </div>

          <div class="download-section">
            <button
              class="btn btn-success"
              id="downloadBtn"
              disabled
              style="width: 100%; font-size: 16px"
            >
              üíæ Download Semua Foto
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      class Photobooth {
        constructor() {
          this.video = document.getElementById("video");
          this.canvas = document.getElementById("canvas");
          this.ctx = this.canvas.getContext("2d");
          this.photos = [];
          this.currentPhotoIndex = 0;
          this.retakeCount = 3;
          this.currentFrame = "none";
          this.currentFilter = "none";
          this.stickers = [];

          this.initializeEventListeners();
          this.updateUI();
        }

        initializeEventListeners() {
          document
            .getElementById("startBtn")
            .addEventListener("click", () => this.startCamera());
          document
            .getElementById("captureBtn")
            .addEventListener("click", () => this.capturePhoto());
          document
            .getElementById("retakeBtn")
            .addEventListener("click", () => this.retakePhoto());
          document
            .getElementById("downloadBtn")
            .addEventListener("click", () => this.downloadPhotos());
          document
            .getElementById("clearStickers")
            .addEventListener("click", () => this.clearStickers());

          // Frame selection
          document.querySelectorAll(".frame-option").forEach((option) => {
            option.addEventListener("click", (e) =>
              this.selectFrame(e.target.dataset.frame)
            );
          });

          // Filter selection
          document.querySelectorAll(".filter-option").forEach((option) => {
            option.addEventListener("click", (e) =>
              this.selectFilter(e.target.dataset.filter)
            );
          });

          // Sticker selection
          document.querySelectorAll(".sticker-option").forEach((option) => {
            option.addEventListener("click", (e) =>
              this.addSticker(e.target.dataset.sticker)
            );
          });
        }

        async startCamera() {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({
              video: { facingMode: "user" },
              audio: false,
            });
            this.video.srcObject = stream;
            this.video.style.display = "block";
            document.getElementById("captureBtn").disabled = false;
            document.getElementById("startBtn").disabled = true;
          } catch (err) {
            alert(
              "Tidak dapat mengakses kamera. Pastikan Anda memberikan izin kamera."
            );
            console.error("Error accessing camera:", err);
          }
        }

        selectFrame(frame) {
          this.currentFrame = frame;
          document
            .querySelectorAll(".frame-option")
            .forEach((opt) => opt.classList.remove("active"));
          document
            .querySelector(`[data-frame="${frame}"]`)
            .classList.add("active");
          this.updateFrameOverlay();
        }

        selectFilter(filter) {
          this.currentFilter = filter;
          document
            .querySelectorAll(".filter-option")
            .forEach((opt) => opt.classList.remove("active"));
          document
            .querySelector(`[data-filter="${filter}"]`)
            .classList.add("active");
          this.applyVideoFilter();
        }

        applyVideoFilter() {
          const video = this.video;
          let filterStyle = "";

          switch (this.currentFilter) {
            case "grayscale":
              filterStyle = "grayscale(100%)";
              break;
            case "sepia":
              filterStyle = "sepia(100%)";
              break;
            case "vintage":
              filterStyle = "sepia(50%) contrast(120%) brightness(110%)";
              break;
            case "bright":
              filterStyle = "brightness(130%) contrast(110%)";
              break;
            case "contrast":
              filterStyle = "contrast(150%) saturate(120%)";
              break;
            default:
              filterStyle = "none";
          }

          video.style.filter = filterStyle;
        }

        updateFrameOverlay() {
          const overlay = document.getElementById("frameOverlay");
          let frameHTML = "";

          switch (this.currentFrame) {
            case "classic":
              frameHTML =
                '<div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; border: 25px solid; border-image: linear-gradient(45deg, #8B4513, #D2691E, #8B4513, #D2691E) 1;"></div>';
              break;
            case "polaroid":
              frameHTML =
                '<div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; border: 20px solid white; box-shadow: 0 0 30px rgba(0,0,0,0.4);"></div><div style="position: absolute; bottom: 20px; left: 20px; right: 20px; height: 80px; background: white; display: flex; align-items: center; justify-content: center; font-family: cursive; font-size: 18px; color: #333;">Beautiful Memories ‚ú®</div>';
              break;
            case "heart":
              frameHTML = `
                            <div style="position: absolute; top: 15px; left: 15px; font-size: 35px; animation: heartBeat 1.5s infinite;">üíñ</div>
                            <div style="position: absolute; top: 15px; right: 15px; font-size: 35px; animation: heartBeat 1.8s infinite;">üíï</div>
                            <div style="position: absolute; bottom: 15px; left: 15px; font-size: 35px; animation: heartBeat 2s infinite;">üíù</div>
                            <div style="position: absolute; bottom: 15px; right: 15px; font-size: 35px; animation: heartBeat 1.3s infinite;">‚ù§Ô∏è</div>
                            <div style="position: absolute; top: 50%; left: 15px; transform: translateY(-50%); font-size: 30px; animation: heartBeat 1.6s infinite;">üíó</div>
                            <div style="position: absolute; top: 50%; right: 15px; transform: translateY(-50%); font-size: 30px; animation: heartBeat 1.9s infinite;">üíì</div>
                        `;
              break;
            case "star":
              frameHTML = `
                            <div style="position: absolute; top: 10px; left: 10px; font-size: 30px; animation: twinkle 2s infinite;">‚≠ê</div>
                            <div style="position: absolute; top: 10px; right: 10px; font-size: 30px; animation: twinkle 2.5s infinite;">üåü</div>
                            <div style="position: absolute; bottom: 10px; left: 10px; font-size: 30px; animation: twinkle 1.8s infinite;">‚ú®</div>
                            <div style="position: absolute; bottom: 10px; right: 10px; font-size: 30px; animation: twinkle 2.2s infinite;">‚≠ê</div>
                            <div style="position: absolute; top: 30%; left: 10px; font-size: 25px; animation: twinkle 1.5s infinite;">üåü</div>
                            <div style="position: absolute; top: 70%; right: 10px; font-size: 25px; animation: twinkle 2.8s infinite;">‚ú®</div>
                        `;
              break;
            case "circle":
              frameHTML =
                '<div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; border: 20px solid transparent; border-radius: 50%; background: linear-gradient(white, white) padding-box, linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #fd79a8) border-box;"></div>';
              break;
            case "rainbow":
              frameHTML =
                '<div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; border: 25px solid transparent; background: linear-gradient(white, white) padding-box, linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #00ff00, #0080ff, #8000ff, #ff0080) border-box;"></div>';
              break;
            case "gold":
              frameHTML =
                '<div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; border: 30px solid transparent; background: linear-gradient(white, white) padding-box, linear-gradient(45deg, #ffd700, #ffed4e, #ffd700, #b8860b) border-box; box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);"></div>';
              break;
            case "vintage":
              frameHTML = `
                            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; border: 20px solid #8B4513; background: repeating-linear-gradient(45deg, #8B4513, #8B4513 10px, #A0522D 10px, #A0522D 20px);"></div>
                            <div style="position: absolute; top: 10px; left: 10px; font-size: 25px;">üé≠</div>
                            <div style="position: absolute; top: 10px; right: 10px; font-size: 25px;">üé™</div>
                            <div style="position: absolute; bottom: 10px; left: 10px; font-size: 25px;">üé®</div>
                            <div style="position: absolute; bottom: 10px; right: 10px; font-size: 25px;">üé¨</div>
                        `;
              break;
            case "neon":
              frameHTML =
                '<div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; border: 15px solid transparent; background: linear-gradient(white, white) padding-box, linear-gradient(45deg, #ff0080, #00ffff, #ff0080, #00ffff) border-box; box-shadow: 0 0 30px #ff0080, inset 0 0 30px #00ffff; animation: neonGlow 2s infinite alternate;"></div>';
              break;
            case "floral":
              frameHTML = `
                            <div style="position: absolute; top: 10px; left: 10px; font-size: 30px;">üå∏</div>
                            <div style="position: absolute; top: 10px; right: 10px; font-size: 30px;">üå∫</div>
                            <div style="position: absolute; bottom: 10px; left: 10px; font-size: 30px;">üåª</div>
                            <div style="position: absolute; bottom: 10px; right: 10px; font-size: 30px;">üå∑</div>
                            <div style="position: absolute; top: 30%; left: 5px; font-size: 25px;">üåπ</div>
                            <div style="position: absolute; top: 60%; right: 5px; font-size: 25px;">üåº</div>
                            <div style="position: absolute; top: 20%; right: 5px; font-size: 20px;">üçÉ</div>
                            <div style="position: absolute; bottom: 30%; left: 5px; font-size: 20px;">üåø</div>
                        `;
              break;
            case "geometric":
              frameHTML = `
                            <div style="position: absolute; top: 15px; left: 15px; width: 40px; height: 40px; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); transform: rotate(45deg);"></div>
                            <div style="position: absolute; top: 15px; right: 15px; width: 40px; height: 40px; background: linear-gradient(45deg, #45b7d1, #96ceb4); border-radius: 50%;"></div>
                            <div style="position: absolute; bottom: 15px; left: 15px; width: 40px; height: 40px; background: linear-gradient(45deg, #ffeaa7, #fd79a8); clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
                            <div style="position: absolute; bottom: 15px; right: 15px; width: 40px; height: 40px; background: linear-gradient(45deg, #a29bfe, #6c5ce7); transform: rotate(45deg);"></div>
                        `;
              break;
          }

          overlay.innerHTML = frameHTML;
        }

        addSticker(emoji) {
          const overlay = document.getElementById("stickerOverlay");
          const sticker = document.createElement("div");
          sticker.className = "sticker";
          sticker.textContent = emoji;
          sticker.style.left = Math.random() * 70 + 15 + "%";
          sticker.style.top = Math.random() * 70 + 15 + "%";

          // Make sticker draggable
          this.makeDraggable(sticker);
          overlay.appendChild(sticker);
          this.stickers.push(sticker);
        }

        makeDraggable(element) {
          let isDragging = false;
          let startX, startY, startLeft, startTop;

          element.addEventListener("mousedown", (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            startLeft = parseInt(element.style.left);
            startTop = parseInt(element.style.top);
            e.preventDefault();
          });

          document.addEventListener("mousemove", (e) => {
            if (!isDragging) return;

            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;

            element.style.left =
              startLeft +
              (deltaX / element.parentElement.offsetWidth) * 100 +
              "%";
            element.style.top =
              startTop +
              (deltaY / element.parentElement.offsetHeight) * 100 +
              "%";
          });

          document.addEventListener("mouseup", () => {
            isDragging = false;
          });

          // Double click to remove
          element.addEventListener("dblclick", () => {
            element.remove();
            const index = this.stickers.indexOf(element);
            if (index > -1) this.stickers.splice(index, 1);
          });
        }

        clearStickers() {
          const overlay = document.getElementById("stickerOverlay");
          overlay.innerHTML = "";
          this.stickers = [];
        }

        capturePhoto() {
          const video = this.video;
          this.canvas.width = video.videoWidth;
          this.canvas.height = video.videoHeight;

          // Apply filter to canvas
          this.applyCanvasFilter();

          // Save context and flip horizontally to fix mirror effect
          this.ctx.save();
          this.ctx.scale(-1, 1);
          this.ctx.drawImage(video, -this.canvas.width, 0);
          this.ctx.restore();

          // Draw frame overlay
          this.drawFrameOnCanvas();

          // Draw stickers
          this.drawStickersOnCanvas();

          // Convert to data URL and store
          const dataURL = this.canvas.toDataURL("image/jpeg", 0.9);
          this.photos[this.currentPhotoIndex] = dataURL;

          // Update photo strip
          this.updatePhotoStrip();

          // Move to next photo or finish
          this.currentPhotoIndex++;
          if (this.currentPhotoIndex >= 6) {
            this.finishPhotos();
          } else {
            this.prepareNextPhoto();
          }
        }

        applyCanvasFilter() {
          this.ctx.filter = this.video.style.filter || "none";
        }

        drawFrameOnCanvas() {
          const canvas = this.canvas;
          const ctx = this.ctx;

          ctx.save();

          switch (this.currentFrame) {
            case "classic":
              // Classic brown border
              const gradient = ctx.createLinearGradient(
                0,
                0,
                canvas.width,
                canvas.height
              );
              gradient.addColorStop(0, "#D2691E");
              gradient.addColorStop(0.5, "#8B4513");
              gradient.addColorStop(1, "#D2691E");
              ctx.strokeStyle = gradient;
              ctx.lineWidth = 40;
              ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);
              break;

            case "polaroid":
              // White polaroid frame
              ctx.fillStyle = "white";
              ctx.fillRect(0, 0, canvas.width, 30);
              ctx.fillRect(0, 0, 30, canvas.height);
              ctx.fillRect(canvas.width - 30, 0, 30, canvas.height);
              ctx.fillRect(0, canvas.height - 120, canvas.width, 120);

              // Add text on bottom
              ctx.fillStyle = "#333";
              ctx.font = "bold 24px cursive";
              ctx.textAlign = "center";
              ctx.fillText(
                "Beautiful Memories ‚ú®",
                canvas.width / 2,
                canvas.height - 50
              );
              break;

            case "heart":
              // Draw hearts in corners
              ctx.font = "60px Arial";
              ctx.fillText("üíñ", 30, 80);
              ctx.fillText("üíï", canvas.width - 90, 80);
              ctx.fillText("üíù", 30, canvas.height - 30);
              ctx.fillText("‚ù§Ô∏è", canvas.width - 90, canvas.height - 30);

              // Side hearts
              ctx.font = "50px Arial";
              ctx.fillText("üíó", 30, canvas.height / 2);
              ctx.fillText("üíì", canvas.width - 80, canvas.height / 2);
              break;

            case "star":
              // Draw stars
              ctx.font = "50px Arial";
              ctx.fillText("‚≠ê", 30, 70);
              ctx.fillText("üåü", canvas.width - 80, 70);
              ctx.fillText("‚ú®", 30, canvas.height - 30);
              ctx.fillText("‚≠ê", canvas.width - 80, canvas.height - 30);

              ctx.font = "40px Arial";
              ctx.fillText("üåü", 30, canvas.height * 0.3);
              ctx.fillText("‚ú®", canvas.width - 70, canvas.height * 0.7);
              break;

            case "rainbow":
              // Rainbow border
              const rainbowGrad = ctx.createLinearGradient(
                0,
                0,
                canvas.width,
                0
              );
              rainbowGrad.addColorStop(0, "#ff0000");
              rainbowGrad.addColorStop(0.16, "#ff8000");
              rainbowGrad.addColorStop(0.33, "#ffff00");
              rainbowGrad.addColorStop(0.5, "#00ff00");
              rainbowGrad.addColorStop(0.66, "#0080ff");
              rainbowGrad.addColorStop(0.83, "#8000ff");
              rainbowGrad.addColorStop(1, "#ff0080");

              ctx.strokeStyle = rainbowGrad;
              ctx.lineWidth = 50;
              ctx.strokeRect(25, 25, canvas.width - 50, canvas.height - 50);
              break;

            case "gold":
              // Gold frame
              const goldGrad = ctx.createLinearGradient(
                0,
                0,
                canvas.width,
                canvas.height
              );
              goldGrad.addColorStop(0, "#ffd700");
              goldGrad.addColorStop(0.5, "#ffed4e");
              goldGrad.addColorStop(1, "#b8860b");

              ctx.strokeStyle = goldGrad;
              ctx.lineWidth = 60;
              ctx.strokeRect(30, 30, canvas.width - 60, canvas.height - 60);

              // Add inner shadow effect
              ctx.strokeStyle = "#b8860b";
              ctx.lineWidth = 10;
              ctx.strokeRect(55, 55, canvas.width - 110, canvas.height - 110);
              break;

            case "vintage":
              // Vintage wooden frame
              ctx.strokeStyle = "#8B4513";
              ctx.lineWidth = 40;
              ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

              // Add vintage elements
              ctx.font = "45px Arial";
              ctx.fillText("üé≠", 40, 80);
              ctx.fillText("üé™", canvas.width - 85, 80);
              ctx.fillText("üé®", 40, canvas.height - 40);
              ctx.fillText("üé¨", canvas.width - 85, canvas.height - 40);
              break;

            case "floral":
              // Floral decorations
              ctx.font = "50px Arial";
              ctx.fillText("üå∏", 30, 70);
              ctx.fillText("üå∫", canvas.width - 80, 70);
              ctx.fillText("üåª", 30, canvas.height - 30);
              ctx.fillText("üå∑", canvas.width - 80, canvas.height - 30);

              ctx.font = "40px Arial";
              ctx.fillText("üåπ", 20, canvas.height * 0.3);
              ctx.fillText("üåº", canvas.width - 60, canvas.height * 0.6);
              ctx.fillText("üçÉ", canvas.width - 60, canvas.height * 0.2);
              ctx.fillText("üåø", 20, canvas.height * 0.7);
              break;

            case "geometric":
              // Geometric shapes in corners
              ctx.fillStyle = "#ff6b6b";
              ctx.save();
              ctx.translate(40, 40);
              ctx.rotate(Math.PI / 4);
              ctx.fillRect(-20, -20, 40, 40);
              ctx.restore();

              ctx.fillStyle = "#4ecdc4";
              ctx.beginPath();
              ctx.arc(canvas.width - 40, 40, 20, 0, 2 * Math.PI);
              ctx.fill();

              ctx.fillStyle = "#ffeaa7";
              ctx.beginPath();
              ctx.moveTo(40, canvas.height - 20);
              ctx.lineTo(20, canvas.height - 60);
              ctx.lineTo(60, canvas.height - 60);
              ctx.closePath();
              ctx.fill();

              ctx.fillStyle = "#a29bfe";
              ctx.save();
              ctx.translate(canvas.width - 40, canvas.height - 40);
              ctx.rotate(Math.PI / 4);
              ctx.fillRect(-20, -20, 40, 40);
              ctx.restore();
              break;
          }

          ctx.restore();
        }

        drawStickersOnCanvas() {
          const canvas = this.canvas;
          const ctx = this.ctx;

          this.stickers.forEach((sticker) => {
            const stickerRect = sticker.getBoundingClientRect();
            const overlayRect = sticker.parentElement.getBoundingClientRect();

            // Calculate relative position
            const relativeX =
              (stickerRect.left - overlayRect.left) / overlayRect.width;
            const relativeY =
              (stickerRect.top - overlayRect.top) / overlayRect.height;

            // Scale to canvas size
            const x = relativeX * canvas.width;
            const y = relativeY * canvas.height;

            // Draw sticker
            ctx.save();
            ctx.font = "bold 80px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";

            // Add shadow effect
            ctx.shadowColor = "rgba(0,0,0,0.3)";
            ctx.shadowBlur = 4;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;

            ctx.fillText(sticker.textContent, x + 40, y + 40);
            ctx.restore();
          });
        }

        retakePhoto() {
          if (this.retakeCount > 0 && this.currentPhotoIndex > 0) {
            this.retakeCount--;
            this.currentPhotoIndex--;
            this.photos[this.currentPhotoIndex] = null;
            this.updatePhotoStrip();
            this.updateUI();
          }
        }

        prepareNextPhoto() {
          // Clear stickers for next photo
          this.clearStickers();
          this.updateUI();
        }

        finishPhotos() {
          document.getElementById("captureBtn").disabled = true;
          document.getElementById("retakeBtn").disabled = true;
          document.getElementById("downloadBtn").disabled = false;

          // Stop camera
          if (this.video.srcObject) {
            this.video.srcObject.getTracks().forEach((track) => track.stop());
          }

          alert(
            "Semua foto telah diambil! Anda bisa mendownload hasilnya sekarang."
          );
        }

        updatePhotoStrip() {
          for (let i = 0; i < 6; i++) {
            const slot = document.getElementById(`slot${i + 1}`);
            if (this.photos[i]) {
              slot.innerHTML = `
                            <img src="${this.photos[i]}" alt="Foto ${i + 1}">
                            <button class="photo-delete-btn" onclick="photobooth.deletePhoto(${i})" title="Hapus foto">√ó</button>
                        `;
            } else {
              slot.innerHTML = `Foto ${i + 1}`;
            }
          }
        }

        updateUI() {
          document.getElementById(
            "retakeCount"
          ).textContent = `Sisa Retake: ${this.retakeCount}`;
          document.getElementById("retakeBtn").disabled =
            this.retakeCount === 0 || this.currentPhotoIndex === 0;
        }

        deletePhoto(index) {
          if (confirm(`Apakah Anda yakin ingin menghapus Foto ${index + 1}?`)) {
            this.photos[index] = null;
            this.updatePhotoStrip();

            // If we deleted a photo and haven't finished all 6, allow continuing
            if (this.currentPhotoIndex >= 6) {
              // Find first empty slot
              const emptyIndex = this.photos.findIndex(
                (photo) => photo === null
              );
              if (emptyIndex !== -1) {
                this.currentPhotoIndex = emptyIndex;
                document.getElementById("captureBtn").disabled = false;
                document.getElementById("retakeBtn").disabled = false;
              }
            }

            // Update download button state
            const hasPhotos = this.photos.some((photo) => photo !== null);
            document.getElementById("downloadBtn").disabled = !hasPhotos;

            this.updateUI();
          }
        }

        async downloadPhotos() {
          if (this.photos.filter((p) => p).length === 0) {
            alert("Tidak ada foto untuk didownload!");
            return;
          }

          // Create a photobooth strip canvas (6 frames in 2x3 layout)
          const stripCanvas = document.createElement("canvas");
          const stripCtx = stripCanvas.getContext("2d");

          // Set canvas dimensions for photobooth strip (2 columns, 3 rows)
          const frameWidth = 350;
          const frameHeight = 450;
          const margin = 20;
          const borderWidth = 10;

          stripCanvas.width = frameWidth * 2 + margin * 3 + borderWidth * 2;
          stripCanvas.height = frameHeight * 3 + margin * 4 + borderWidth * 2;

          // White background with border
          stripCtx.fillStyle = "white";
          stripCtx.fillRect(0, 0, stripCanvas.width, stripCanvas.height);

          // Add photobooth style border
          stripCtx.strokeStyle = "#333";
          stripCtx.lineWidth = borderWidth;
          stripCtx.strokeRect(
            borderWidth / 2,
            borderWidth / 2,
            stripCanvas.width - borderWidth,
            stripCanvas.height - borderWidth
          );

          // Add title at the top
          stripCtx.fillStyle = "#333";
          stripCtx.font = "bold 24px Arial";
          stripCtx.textAlign = "center";
          stripCtx.fillText(
            "üì∏ SNAPZIFY PHOTOBOOTH",
            stripCanvas.width / 2,
            40
          );

          // Add date
          stripCtx.font = "16px Arial";
          stripCtx.fillText(
            new Date().toLocaleDateString("id-ID"),
            stripCanvas.width / 2,
            65
          );

          // Draw photos in 2x3 grid layout
          for (let i = 0; i < 6; i++) {
            if (this.photos[i]) {
              const img = new Image();
              await new Promise((resolve) => {
                img.onload = () => {
                  const col = i % 2; // 2 columns
                  const row = Math.floor(i / 2); // 3 rows

                  const x = borderWidth + margin + col * (frameWidth + margin);
                  const y =
                    borderWidth + 80 + margin + row * (frameHeight + margin);

                  // Draw photo frame background
                  stripCtx.fillStyle = "#f8f8f8";
                  stripCtx.fillRect(
                    x - 5,
                    y - 5,
                    frameWidth + 10,
                    frameHeight + 10
                  );

                  // Draw the photo
                  stripCtx.drawImage(img, x, y, frameWidth, frameHeight);

                  // Add frame number
                  stripCtx.fillStyle = "#666";
                  stripCtx.font = "bold 14px Arial";
                  stripCtx.textAlign = "center";
                  stripCtx.fillText(
                    `${i + 1}`,
                    x + frameWidth / 2,
                    y + frameHeight + 20
                  );

                  resolve();
                };
                img.src = this.photos[i];
              });
            } else {
              // Draw empty frame placeholder
              const col = i % 2;
              const row = Math.floor(i / 2);
              const x = borderWidth + margin + col * (frameWidth + margin);
              const y =
                borderWidth + 80 + margin + row * (frameHeight + margin);

              stripCtx.fillStyle = "#f0f0f0";
              stripCtx.fillRect(x, y, frameWidth, frameHeight);
              stripCtx.strokeStyle = "#ddd";
              stripCtx.lineWidth = 2;
              stripCtx.setLineDash([5, 5]);
              stripCtx.strokeRect(x, y, frameWidth, frameHeight);
              stripCtx.setLineDash([]);

              stripCtx.fillStyle = "#999";
              stripCtx.font = "18px Arial";
              stripCtx.textAlign = "center";
              stripCtx.fillText(
                `Frame ${i + 1}`,
                x + frameWidth / 2,
                y + frameHeight / 2
              );
              stripCtx.fillText(
                "(Kosong)",
                x + frameWidth / 2,
                y + frameHeight / 2 + 25
              );
            }
          }

          // Download the photobooth strip
          const link = document.createElement("a");
          link.download = `photobooth-strip-${new Date()
            .toISOString()
            .slice(0, 19)
            .replace(/:/g, "-")}.jpg`;
          link.href = stripCanvas.toDataURL("image/jpeg", 0.95);
          link.click();
        }
      }

      // Initialize the photobooth when page loads
      let photobooth;
      document.addEventListener("DOMContentLoaded", () => {
        photobooth = new Photobooth();
      });
    </script>
  </body>
</html>
